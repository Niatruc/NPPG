# 如何用rb模块发网络封包
- [要记住的事情](#要记住的事情)


## 要记住的事情
可以赋予网络协议字段的值只有以下三种形式：
1. 只包含0和1的字符串（例如`"01001000"`）
2. 只包含正整数的数组（例如`[192, 168, 1, 1]`）
3. 正整数
因此如果值的形式不是以上三种形式，需要先利用/lib/support/kernel.rb中定义的一些方法将值转换为上面三种形式(用法未写)。
**有一个例外是给以太网协议的mac地址字段赋值，值的形式是ASCII字符串（如，`"\xFF\xFF\xFF\xFF\xFF\xFF"`）。这是历史遗留问题……后续可能会改。**

## 本项目定义网络协议的方法
项目在/lib/protocol目录下放置与网络协议有关的类的定义文件，其中：
1. 定义协议头部的文件命名格式为：`<协议简称>_head.rb`，其中的协议头部对应的类名格式为`<协议简称>H`。（例如，IPv4协议头部类的定义放在`ipv4_head.rb`中，其协议头部类名为`IPv4H`）。
2. 定义协议报文的文件命名格式为：`<协议简称>_pac.rb`，其中的协议头部对应的类名格式为`<协议简称>P`。（例如，IPv4协议报文类的定义放在`ipv4_pac.rb`中，其协议报文类名为`IPv4P`）。
3. **协议报文（或称为协议包）类跟协议头部类的区别在于，协议包类包含其协议头部类的实例变量以及其下层协议的协议头部类的实例变量。这个项目就是通过面向对象编程中类的继承来表示网络报文各层协议的衔接关系。如，因为IP报文中，IP协议层的下层是链路层，项目中默认为以太网协议，所以`IPv4P`的父类为`EtherP`类。**
4. `common.rb`定义了协议头部类的公用方法，在定义协议头部类的时候需要引用该文件，并在协议头部类中包含`Common`类。
5. `common_pac.rb`定义了协议报文类的公用方法，在定义协议报文类的时候需要引用该文件，并在协议头部类中包含`CommonPac`类。
